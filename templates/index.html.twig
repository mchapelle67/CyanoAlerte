{% extends 'base.html.twig' %}

{% block metadescription %}{% endblock %}
{% block keywords %}{% endblock %}
{% block robots %}index, follow{% endblock %}

{% block title %}CyanoAlerte - Surveillance des Cyanobactéries{% endblock %}

{% block body %}
<main id="wrapper">
    <section class="hero">
        <figure class="hero-figure">
            <img 
                fetchpriority="high"
                loading="eager"
                decoding="async"
                src="{{ asset('images/lac.jpg') }}" 
                {# srcset="
                    ../images/lac-960.jpg 960w,
                    ../images/lac-1536.jpg 1536w,
                    ../images/lac-2048.jpg 2048w,
                    ../images/lac-2560.jpg 2560w
                "
                sizes="100vw" #}
                alt="Photo d'un lac"
                class="object-cover w-full h-full">
            <div class="absolute inset-0 bg-gradient-to-b from-black/50 via-black/20 to-transparent"></div>
        </figure>
        <div class="hero-content">
            {% include 'sections/_flashMessages.html.twig' %}
            <div class="backdrop-blur-sm bg-white/10 rounded-3xl p-8 lg:p-12 shadow-2xl border border-white/20 max-w-4xl">
                <h1 class="custom-h1-hero text-white drop-shadow-lg mb-6">
                    Protégez les <span class="text-blue-300 font-semibold">eaux</span>, <br>
                    signalez les <span class="text-green-300 font-semibold">cyanobactéries</span>
                </h1>
                <p class="custom-p text-white/90 drop-shadow-md mb-8 leading-relaxed">
                    Signalez et consultez les alertes de cyanobactéries dans les lacs, rivières et étangs.<br>
                    Aidez à protéger la santé publique et l'environnement aquatique.
                </p>
                <div class="flex gap-4 justify-center flex-wrap">
                   <twig:PrimaryButton 
                        text="Découvrir la carte"
                        class="font-medium text-lg hover:-translate-y-1"
                        href="{{ path('app_home') }}#map"
                    />
                   <twig:SecondaryButton 
                        text="Voir les alertes"
                        class="font-medium text-lg"
                        href="{{ path('app_alerts') }}"
                    />
                </div>
            </div>
        </div>
    </section>
    <section class="custom-padding flex gap-6">
        {% include 'sections/_map.html.twig' %}
        <section class="w-[40%] h-[600px] min-h-0 flex flex-col gap-4">
            <div class="p-5 bg-white custom-border mb-4">
                <h2 class="flex gap-3 items-center custom-h2 text-green-800 mb-4">
                    <svg xmlns="http://www.w3.org/2000/svg" height="25" width="25" viewBox="0 0 640 640"><!--!Font Awesome Free v7.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2026 Fonticons, Inc.--><path fill="#166534" d="M480 272C480 317.9 465.1 360.3 440 394.7L566.6 521.4C579.1 533.9 579.1 554.2 566.6 566.7C554.1 579.2 533.8 579.2 521.3 566.7L394.7 440C360.3 465.1 317.9 480 272 480C157.1 480 64 386.9 64 272C64 157.1 157.1 64 272 64C386.9 64 480 157.1 480 272zM272 416C351.5 416 416 351.5 416 272C416 192.5 351.5 128 272 128C192.5 128 128 192.5 128 272C128 351.5 192.5 416 272 416z"/></svg>
                    Rechercher par zone
                </h2>
                <input type="text" class="zone w-full p-2 rounded border-gray-300 focus:border-blue-300 placeholder-gray-400" name="zone" id="zone" placeholder="Saisir une ville ou un département...">                    
                    <ul id="zoneResults" class="mt-2"></ul>
            </div>
            <div class="p-5 bg-white custom-border flex-1 min-h-0 overflow-y-auto">
                <h2 class="flex items-center gap-3 custom-h2 pb-5 text-center text-green-800">
                    <svg xmlns="http://www.w3.org/2000/svg" height="25" width="25" viewBox="0 0 640 640"><!--!Font Awesome Free v7.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2026 Fonticons, Inc.--><path fill="#166534" d="M528 320C528 434.9 434.9 528 320 528C205.1 528 112 434.9 112 320C112 205.1 205.1 112 320 112C434.9 112 528 205.1 528 320zM64 320C64 461.4 178.6 576 320 576C461.4 576 576 461.4 576 320C576 178.6 461.4 64 320 64C178.6 64 64 178.6 64 320zM296 184L296 320C296 328 300 335.5 306.7 340L402.7 404C413.7 411.4 428.6 408.4 436 397.3C443.4 386.2 440.4 371.4 429.3 364L344 307.2L344 184C344 170.7 333.3 160 320 160C306.7 160 296 170.7 296 184z"/></svg>
                    Dernières alertes
                </h2>
                {% if homeData.lastAlerts is not empty %}
                    {% for alert in homeData.lastAlerts %}
                        {% set level = alert.toxicity_level.level|default(0) %}
                        {% set levelClass = level == 3 ? 'highlevelcolor' : (level == 2 ? 'mediumlevelcolor' : (level == 1 ? 'lowlevelcolor' : 'neutrecolor')) %}
                        <div class="alert-card {{ levelClass }} hover:shadow-sm">
                            <h3 class="text-lg font-semibold text-gray-800">
                                {{ alert.waterbody.name ?? 'Nom du plan d\'eau non renseigné' }}
                            </h3>
                            <p class="text-sm text-gray-600">
                                <span class="font-semibold">{{ alert.waterbody.city ?? 'Ville non renseignée' }}</span>, département : {{ alert.waterbody.department ?? 'N/A' }}
                            </p>
                            <p class="text-xs text-gray-500 mt-2">{{ alert.created_at|date('d M Y H:i') }}</p>
                        </div>
                    {% endfor %}
                   <twig:PrimaryButton 
                        text="Toutes les alertes"
                        class="mx-auto font-medium mt-8 mb-4 hover:-translate-y-1"
                        href="{{ path('app_alerts') }}"
                    />
                {% else %}
                    <p class="text-center text-gray-600 py-6 border-t-2">
                        Aucune alerte récente. Signalez une suspicion de cyanobactéries en cliquant directement sur la carte.
                    </p>               
                {% endif %} 
            </div>
        </section>
    </section>
    <section class="pb-4 flex w-full mx-auto justify-center px-10 gap-6">
        <twig:Card
        icon='<img src="{{ asset("images/icons/alerte.png") }}" alt="Icône alerte" class="w-10 h-10" />'
        title="Alertes totales"
        subtitle="signalements en cours"
        number="{{ homeData.alertsActivesCount }}"
        color="text-blue-600"
        />
        <twig:Card
        icon='<img src="{{ asset("images/icons/localisateur.png") }}" alt="Icône zones surveillées" class="w-10 h-10" />'
        title="Zones surveillées"
        subtitle="départements couverts"
        number="{{ homeData.departmentsCount }}"
        color="text-green-700"
        />
        <twig:Card
        icon='<img src="{{ asset("images/icons/line-up.png") }}" alt="Icône alertes prioritaires" class="w-10 h-10" />'
        title="Niveau élevé"
        subtitle="alertes prioritaires"
        number="{{ homeData.highLevelCount }}"
        color="text-red-600"
        />
        <twig:Card
        icon='<img src="{{ asset("images/icons/calendar.png") }}" alt="Icône nouveaux signalements" class="w-10 h-10" />'
        title="Nouveaux signalements"
        subtitle="cette semaine"
        number="{{ homeData.newAlertsCount }}"
        color="text-orange-600"
        />
    </section>
    <div class="py-8 flex justify-center">
        <a href="{{ path('app_alerts') }}" class="gap-2 items-center flex hover:-translate-y-1 text-lg backdrop-blur-md bg-white/60 text-gray-700 px-6 py-3 rounded-xl font-medium border-2 border-gray-200 hover:bg-white transition-all duration-300">
        <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6" viewBox="0 0 640 640" class="inline align-middle text-inherit h-[1.2em] w-[1.2em]"><path fill="currentColor" d="M104 112C90.7 112 80 122.7 80 136L80 184C80 197.3 90.7 208 104 208L152 208C165.3 208 176 197.3 176 184L176 136C176 122.7 165.3 112 152 112L104 112zM256 128C238.3 128 224 142.3 224 160C224 177.7 238.3 192 256 192L544 192C561.7 192 576 177.7 576 160C576 142.3 561.7 128 544 128L256 128zM256 288C238.3 288 224 302.3 224 320C224 337.7 238.3 352 256 352L544 352C561.7 352 576 337.7 576 320C576 302.3 561.7 288 544 288L256 288zM256 448C238.3 448 224 462.3 224 480C224 497.7 238.3 512 256 512L544 512C561.7 512 576 497.7 576 480C576 462.3 561.7 448 544 448L256 448zM80 296L80 344C80 357.3 90.7 368 104 368L152 368C165.3 368 176 357.3 176 344L176 296C176 282.7 165.3 272 152 272L104 272C90.7 272 80 282.7 80 296zM104 432C90.7 432 80 442.7 80 456L80 504C80 517.3 90.7 528 104 528L152 528C165.3 528 176 517.3 176 504L176 456C176 442.7 165.3 432 152 432L104 432z"/></svg>   
            Voir toutes les alertes
        </a>
    </div>
    <section class="mx-10 mt-4 space-y-8">
        {{ include("/sections/_infosCards.html.twig") }}
    </section>
</main>
{% endblock %}
